---
title: rust.03 ruståŸºç¡€çŸ¥è¯†
date: 2023-12-14 23:08:00
categories:
  - The Rust Programming Language
tags:
  - readnotes
  -  Rust
---

## å˜é‡å’Œå¯è§æ€§

Rustä¸­ï¼Œ***å˜é‡é»˜è®¤æ˜¯ä¸å¯å˜çš„ï¼ˆimmutableï¼‰***ï¼Œä½¿ç”¨ `mut`ä½¿å…¶å¯å˜ã€‚

```rust
fn main() {
    let x = 5;
    x = 6; // error
    
    let mut y = 10;
    y = 11; // correct
}
```

å¸¸é‡ï¼ˆ*constants*ï¼‰åˆ™æ€»æ˜¯ä¸å¯å˜ï¼Œä¹Ÿä¸èƒ½ç”¨`mut`ä¿®é¥°ï¼Œå¹¶ä¸”å¿…é¡»æ˜¾å¼æŒ‡å®šæ•°æ®ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨å¸¸é‡æ±‚å€¼ã€‚

```rust
const THREE_HOURS_IN_SECONDS: u32 = 60 * 60 * 3;
```

**éšè—/è¦†ç›–ï¼ˆShadowingï¼‰**æ˜¯æŒ‡Rustä¸­å¯ä»¥å£°æ˜ä¸€ä¸ªå’Œä¹‹å‰å˜é‡åŒåçš„æ–°å˜é‡ï¼Œæ–°å˜é‡ä¼šè¦†ç›–æ—§çš„å˜é‡ï¼Œå› æ­¤æ•°æ®ç±»å‹å¯ä»¥å’Œæ—§çš„å˜é‡ä¸ä¸€è‡´ã€‚

```rust
fn main() {
    let x = 5;  // x = 5
    let x = x + 3; // x = 8
    {
        let x = x + 5; // x = 13
    }
    let x = x + 6; // x = 14
    
    let space = "    "; // spaceæ˜¯å­—ç¬¦ä¸²
    let space = space.len(); // spaceæ˜¯æ•´å‹
}
```

## æ•°æ®ç±»å‹

åœ¨ Rust ä¸­ï¼Œæ¯ä¸€ä¸ªå€¼éƒ½å±äºæŸä¸€ä¸ª **æ•°æ®ç±»å‹**ï¼ˆ*data type*ï¼‰ï¼Œè¿™å‘Šè¯‰ Rust å®ƒè¢«æŒ‡å®šä¸ºä½•ç§æ•°æ®ï¼Œä»¥ä¾¿æ˜ç¡®æ•°æ®å¤„ç†æ–¹å¼ã€‚æˆ‘ä»¬å°†çœ‹åˆ°ä¸¤ç±»æ•°æ®ç±»å‹å­é›†ï¼šæ ‡é‡ï¼ˆscalarï¼‰å’Œå¤åˆï¼ˆcompoundï¼‰ã€‚

è®°ä½ï¼ŒRust æ˜¯ **é™æ€ç±»å‹**ï¼ˆ*statically typed*ï¼‰è¯­è¨€ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨ç¼–è¯‘æ—¶å°±å¿…é¡»çŸ¥é“æ‰€æœ‰å˜é‡çš„ç±»å‹ã€‚æ ¹æ®å€¼åŠå…¶ä½¿ç”¨æ–¹å¼ï¼Œç¼–è¯‘å™¨é€šå¸¸å¯ä»¥æ¨æ–­å‡ºæˆ‘ä»¬æƒ³è¦ç”¨çš„ç±»å‹ã€‚å½“å¤šç§ç±»å‹å‡æœ‰å¯èƒ½æ—¶ï¼Œå¿…é¡»å¢åŠ ç±»å‹æ³¨è§£ï¼Œåƒè¿™æ ·ï¼š

```rust
let guess: u32 = "42".parse().expect("Not a number!");
```

å› ä¸º`parse`å¯ä»¥è¿”å›æ•´å‹ã€æµ®ç‚¹ç­‰å¤šç§æ•°æ®ï¼Œå› æ­¤éœ€è¦æŒ‡å®š`guess`çš„ç±»å‹ã€‚

### æ•´å‹

| é•¿åº¦              | æœ‰ç¬¦å·  | æ— ç¬¦å·  |
| ----------------- | ------- | ------- |
| 8-bit             | `i8`    | `u8`    |
| 16-bit            | `i16`   | `u16`   |
| 32-bit            | `i32`   | `u32`   |
| 64-bit            | `i64`   | `u64`   |
| 128-bit           | `i128`  | `u128`  |
| archï¼ˆ32ä½/64ä½ï¼‰ | `isize` | `usize` |

```rust
let x = 98_222; // 98222
let x = 0xff;   // 16è¿›åˆ¶
let x = 0o77;   // 8è¿›åˆ¶
let x = 0b1111_0000_1111;  // 2è¿›åˆ¶
let x = b'A';   // u8 byte
```

Rustä¸­æ•´å‹é»˜è®¤ä¸º `i32` ï¼Œé›†åˆç´¢å¼•ç”¨ `isize` æˆ– `usize`ã€‚

#### æ•´å‹æº¢å‡º

æ—¢ç„¶Rustæ ‡æ¦œè‡ªå·±å®‰å…¨ï¼Œé‚£ä¹ˆæ€ä¹ˆå¤„ç†æ•´å‹æº¢å‡ºå‘¢ï¼Ÿ

é¦–å…ˆï¼Œdebugç¼–è¯‘æ—¶ï¼Œç¼–è¯‘å™¨ä¼šé™æ€æ£€æµ‹å¯ä»¥æ£€æµ‹åˆ°çš„æº¢å‡ºï¼ˆæ¯”å¦‚å°†256èµ‹å€¼ç»™u8ï¼‰ï¼Œä½†æ˜¯releaseæ—¶ä¸ä¼šæ£€æµ‹ã€‚

å…¶æ¬¡åœ¨è¿›è¡Œæ•´å‹è®¡ç®—æ—¶ï¼Œä½¿ç”¨ï¼š

- `warpping_add`ç­‰`warpping`æ–¹æ³•ï¼š![image-20231214234022501](https://cdn.astero.xyz/img/202312142341379.png)

- `checked_add`ç­‰`checked_`æ–¹æ³•ï¼Œè¿”å›`Option`å¯¹è±¡ï¼ˆæ‹¥æœ‰`Some`å’Œ`None`ä¸¤ç§çŠ¶æ€ï¼‰ï¼Œå¦‚æœå‡ºç°æº¢å‡ºï¼Œè¿”å›`None`
- `overflowing_add`ç­‰`overflowing_`æ–¹æ³•ï¼Œè¿”å›ä¸¤ä¸ªå€¼ï¼Œå…¶ä¸­ä¸€ä¸ª`bool`è¡¨ç¤ºæ˜¯å¦å‡ºç°æº¢å‡ºï¼›
- `saturating_add`ç­‰`saturating_`æ–¹æ³•ï¼Œä¸ä¼šè¿›è¡Œè¡¥ç æº¢å‡ºï¼›

### æµ®ç‚¹å‹

åˆ†ä¸º`f32` å’Œ `f64`ä¸¤ç§ï¼Œé»˜è®¤ä¸º`f64`ã€‚

```rust
fn main() {
    let x = 2.0; // f64 åŒç²¾åº¦

    let y: f32 = 3.0; // f32 å•ç²¾åº¦
}

```

### æ•°å€¼è®¡ç®—

```rust
fn main() {
    // addition
    let sum = 5 + 10;

    // subtraction
    let difference = 95.5 - 4.3;

    // multiplication
    let product = 4 * 30;

    // division
    let quotient = 56.7 / 32.2;
    let truncated = -5 / 3; // ç»“æœä¸º -1ï¼Œå‘é›¶èˆå…¥

    // remainder
    let remainder = 43 % 5;
}

```

### å¸ƒå°”bool

```rust
fn main() {
    let t = true;

    let f: bool = false; // with explicit type annotation
}
```

### å­—ç¬¦char

```rust
fn main() {
    let c = 'z';
    let z: char = 'â„¤'; // with explicit type annotation
    let heart_eyed_cat = 'ğŸ˜»';
}
```

**Rustä¸­çš„`char`å¤§å°ä¸º4å­—èŠ‚**ï¼Œå­˜æ”¾çš„æ˜¯å­—ç¬¦çš„Unicodeå€¼ï¼Œè€Œéå…¶ä»–è¯­è¨€çš„å•å­—èŠ‚ã€‚åŒæ—¶ï¼Œç©ºç™½å­—ç¬¦ä¹Ÿæ˜¯æœ‰æ•ˆçš„å­—ç¬¦ï¼š`let x: char = '';`ã€‚

### å…ƒç»„tuple

å…ƒç»„æ˜¯ä¸€ä¸ªå°†**å¤šä¸ªå…¶ä»–ç±»å‹çš„å€¼ç»„**åˆè¿›ä¸€ä¸ªå¤åˆç±»å‹çš„ä¸»è¦æ–¹å¼ã€‚å…ƒç»„é•¿åº¦å›ºå®šï¼šä¸€æ—¦å£°æ˜ï¼Œ**å…¶é•¿åº¦ä¸ä¼šå¢å¤§æˆ–ç¼©å°**ã€‚

æˆ‘ä»¬ä½¿ç”¨åŒ…å«åœ¨åœ†æ‹¬å·ä¸­çš„é€—å·åˆ†éš”çš„å€¼åˆ—è¡¨æ¥åˆ›å»ºä¸€ä¸ªå…ƒç»„ã€‚å…ƒç»„ä¸­çš„æ¯ä¸€ä¸ªä½ç½®éƒ½æœ‰ä¸€ä¸ªç±»å‹ï¼Œè€Œä¸”è¿™äº›ä¸åŒå€¼çš„ç±»å‹ä¹Ÿä¸å¿…æ˜¯ç›¸åŒçš„ã€‚è¿™ä¸ªä¾‹å­ä¸­ä½¿ç”¨äº†å¯é€‰çš„ç±»å‹æ³¨è§£ï¼š

```rust
fn main() {
    let tup = (500, 6.4, 1);

    let (x, y, z) = tup;

    println!("The value of y is: {y}");
    println!("The value of y is: {tup.1}");
}

```

### æ•°ç»„array

å¦ä¸€ä¸ªåŒ…å«å¤šä¸ªå€¼çš„æ–¹å¼æ˜¯ **æ•°ç»„**ï¼ˆ*array*ï¼‰ã€‚ä¸å…ƒç»„ä¸åŒï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ çš„ç±»å‹å¿…é¡»ç›¸åŒã€‚Rust ä¸­çš„æ•°ç»„ä¸ä¸€äº›å…¶ä»–è¯­è¨€ä¸­çš„æ•°ç»„ä¸åŒï¼ŒRust ä¸­çš„æ•°ç»„é•¿åº¦æ˜¯å›ºå®šçš„ã€‚` let a = [1, 2, 3, 4, 5];`

æ•°ç»„çš„æ•°æ®åˆ†é…åœ¨æ ˆä¸Šè€Œä¸æ˜¯å †ä¸Šã€‚

```rust
let a = [1, 2, 3, 4, 5];

let months = ["January", "February", "March", "April",                     "May", "June", "July", "August", "September",               "October", "November", "December"];

let a: [i32; 5] = [1, 2, 3, 4, 5];

let a = [3; 5];

let first = a[0];
let second = a[1];
let x = a[10]; // index out of bounds
```

## å‡½æ•°fn

Rust ä»£ç ä¸­çš„å‡½æ•°å’Œå˜é‡åä½¿ç”¨ *snake case* è§„èŒƒé£æ ¼ã€‚åœ¨ snake case ä¸­ï¼Œæ‰€æœ‰å­—æ¯éƒ½æ˜¯å°å†™å¹¶ä½¿ç”¨ä¸‹åˆ’çº¿åˆ†éš”å•è¯ã€‚

åœ¨å‡½æ•°ç­¾åä¸­ï¼Œ**å¿…é¡»** å£°æ˜æ¯ä¸ªå‚æ•°çš„ç±»å‹ã€‚è¿™æ˜¯ Rust è®¾è®¡ä¸­ä¸€ä¸ªç»è¿‡æ…é‡è€ƒè™‘çš„å†³å®šï¼šè¦æ±‚åœ¨å‡½æ•°å®šä¹‰ä¸­æä¾›ç±»å‹æ³¨è§£ï¼Œæ„å‘³ç€ç¼–è¯‘å™¨å†ä¹Ÿä¸éœ€è¦ä½ åœ¨ä»£ç çš„å…¶ä»–åœ°æ–¹æ³¨æ˜ç±»å‹æ¥æŒ‡å‡ºä½ çš„æ„å›¾ã€‚è€Œä¸”ï¼Œåœ¨çŸ¥é“å‡½æ•°éœ€è¦ä»€ä¹ˆç±»å‹åï¼Œç¼–è¯‘å™¨å°±èƒ½å¤Ÿç»™å‡ºæ›´æœ‰ç”¨çš„é”™è¯¯æ¶ˆæ¯ã€‚

### è¯­å¥å’Œè¡¨è¾¾å¼

å‡½æ•°ä½“ç”±ä¸€ç³»åˆ—çš„è¯­å¥å’Œä¸€ä¸ªå¯é€‰çš„ç»“å°¾è¡¨è¾¾å¼æ„æˆã€‚ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬æåˆ°çš„å‡½æ•°è¿˜ä¸åŒ…å«ç»“å°¾è¡¨è¾¾å¼ï¼Œä¸è¿‡ä½ å·²ç»è§è¿‡ä½œä¸ºè¯­å¥ä¸€éƒ¨åˆ†çš„è¡¨è¾¾å¼ã€‚å› ä¸º Rust æ˜¯ä¸€é—¨åŸºäºè¡¨è¾¾å¼ï¼ˆexpression-basedï¼‰çš„è¯­è¨€ï¼Œè¿™æ˜¯ä¸€ä¸ªéœ€è¦ç†è§£çš„ï¼ˆä¸åŒäºå…¶ä»–è¯­è¨€ï¼‰é‡è¦åŒºåˆ«ã€‚å…¶ä»–è¯­è¨€å¹¶æ²¡æœ‰è¿™æ ·çš„åŒºåˆ«ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬çœ‹çœ‹è¯­å¥ä¸è¡¨è¾¾å¼æœ‰ä»€ä¹ˆåŒºåˆ«ä»¥åŠè¿™äº›åŒºåˆ«æ˜¯å¦‚ä½•å½±å“å‡½æ•°ä½“çš„ã€‚

**è¯­å¥**ï¼ˆ*Statements*ï¼‰æ˜¯æ‰§è¡Œä¸€äº›æ“ä½œä½†ä¸è¿”å›å€¼çš„æŒ‡ä»¤ã€‚ **è¡¨è¾¾å¼**ï¼ˆ*Expressions*ï¼‰è®¡ç®—å¹¶äº§ç”Ÿä¸€ä¸ªå€¼ã€‚è®©æˆ‘ä»¬çœ‹ä¸€äº›ä¾‹å­ã€‚

å®é™…ä¸Šï¼Œæˆ‘ä»¬å·²ç»ä½¿ç”¨è¿‡è¯­å¥å’Œè¡¨è¾¾å¼ã€‚ä½¿ç”¨ `let` å…³é”®å­—åˆ›å»ºå˜é‡å¹¶ç»‘å®šä¸€ä¸ªå€¼æ˜¯ä¸€ä¸ªè¯­å¥ã€‚`let y = 6;` æ˜¯ä¸€ä¸ªè¯­å¥ï¼Œå‡½æ•°å®šä¹‰ä¹Ÿæ˜¯è¯­å¥ï¼Œè¯­å¥ä¸è¿”å›å€¼ã€‚å› æ­¤ï¼Œä¸èƒ½æŠŠ `let` è¯­å¥èµ‹å€¼ç»™å¦ä¸€ä¸ªå˜é‡ã€‚

```rust
let x = (let y = 6); // error
let x = y = 6; // error
```

è¡¨è¾¾å¼ä¼šè®¡ç®—å‡ºä¸€ä¸ªå€¼ï¼Œ`let y = 6`ä¸­çš„`6`ä¹Ÿæ˜¯è¡¨è¾¾å¼ï¼Œå‡½æ•°è°ƒç”¨æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ã€‚å®è°ƒç”¨æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ã€‚ç”¨å¤§æ‹¬å·åˆ›å»ºçš„ä¸€ä¸ªæ–°çš„å—ä½œç”¨åŸŸä¹Ÿæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ã€‚

```rust
fn main() {
    let y = {
        let x = 3;
        x + 1 //è¡¨è¾¾å¼çš„ç»“å°¾æ²¡æœ‰åˆ†å·ã€‚å¦‚æœåœ¨è¡¨è¾¾å¼çš„ç»“å°¾åŠ ä¸Šåˆ†å·ï¼Œå®ƒå°±å˜æˆäº†è¯­å¥ï¼Œè€Œè¯­å¥ä¸ä¼šè¿”å›å€¼ã€‚
    };

    println!("The value of y is: {y}"); // y = 4
}

```

### å…·æœ‰è¿”å›å€¼çš„å‡½æ•°

å‡½æ•°å¯ä»¥å‘è°ƒç”¨å®ƒçš„ä»£ç è¿”å›å€¼ã€‚æˆ‘ä»¬å¹¶ä¸å¯¹è¿”å›å€¼å‘½åï¼Œä½†è¦åœ¨ç®­å¤´ï¼ˆ`->`ï¼‰åå£°æ˜å®ƒçš„ç±»å‹ã€‚åœ¨ Rust ä¸­ï¼Œå‡½æ•°çš„è¿”å›å€¼ç­‰åŒäºå‡½æ•°ä½“æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ã€‚ä½¿ç”¨ `return` å…³é”®å­—å’ŒæŒ‡å®šå€¼ï¼Œå¯ä»å‡½æ•°ä¸­æå‰è¿”å›ï¼›ä½†å¤§éƒ¨åˆ†å‡½æ•°éšå¼çš„è¿”å›æœ€åçš„è¡¨è¾¾å¼ã€‚

```rust
fn main() {
    let x = plus_one(5);

    println!("The value of x is: {x}");
}

fn plus_one(x: i32) -> i32 {
    x + 1
}
```

## æ³¨é‡Š //

## if è¡¨è¾¾å¼

```rust
fn main() {
    let number = 3;

    if number < 5 {
        println!("condition was true");
    } else if number > 10 {
        println!("condition was false");
    } else {
        
    }
    
    let number = 3;

    if number { // error, use num != 0
        println!("number was three");
    }
}

```

### let if

ç±»ä¼¼äº`python`ï¼Œå¯ä»¥ç»“åˆ`let`å’Œ`if`å¿«é€Ÿåˆå§‹åŒ–

```rust
fn main() {
    let condition = true;
    let number = if condition { 5 } else { 6 };
    
    // error let if æ¯”å¦‚æ¯ä¸ªåˆ†æ”¯è¿”å›å€¼ç±»å‹ä¸€è‡´
    let number = if condition { 5 } else { "six" };

    println!("The value of number is: {number}");
}

```

## å¾ªç¯ loop / while / for

`loop`ä¹Ÿå¯ä»¥è¿”å›å€¼

```rust
fn main() {
    let mut cnt = 0;
    let x = loop {
        cnt += 1;
        if cnt == 10 {
            break cnt * 2;
        }
    }
    // x = 20
}
```

åµŒå¥—å¾ªç¯æ—¶ï¼Œä½¿ç”¨å¸¦æ ‡ç­¾çš„å¾ªç¯ï¼Œé…åˆå¸¦æ ‡ç­¾çš„`break`å’Œ`continue`å®ç°æŒ‡å®šå±‚çš„å¾ªç¯æ§åˆ¶ï¼Œè€Œä¸æ˜¯å½“å‰æœ€å†…å±‚çš„å¾ªç¯ã€‚

```rust
fn main() {
    let mut count = 0;
    'counting_up: loop {
        println!("count = {count}");
        let mut remaining = 10;

        loop {
            println!("remaining = {remaining}");
            if remaining == 9 {
                break;
            }
            if count == 2 {
                break 'counting_up;
            }
            remaining -= 1;
        }

        count += 1;
    }
    println!("End count = {count}");
}

```

`while`å’Œ`if`å†™æ³•ä¸€è‡´ï¼Œä¸åŒçš„æ˜¯`while`æŒç»­åˆ¤æ–­æ¡ä»¶ç›´åˆ°ä¸æ»¡è¶³æ¡ä»¶ï¼Œ`if`åªåˆ¤æ–­ä¸€æ¬¡ã€‚

```rust
fn main() {
    let mut number = 3;

    while number != 0 {
        println!("{number}!");

        number -= 1;
    }

    println!("LIFTOFF!!!");
}
```

`for`ä¸»è¦ç”¨äºéå†é›†åˆï¼Œæœ‰æ•ˆé¿å…`index out of range`ï¼Œ

```rust
fn main() {
    let a = [10, 20, 30, 40, 50];

    for element in a {
        println!("the value is: {element}");
    }
    
    // ä½¿ç”¨range
    for number in (1..4).rev() {
        println!("{number}!");
    }
    println!("LIFTOFF!!!");
}
```

