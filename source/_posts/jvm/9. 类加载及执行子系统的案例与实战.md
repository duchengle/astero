---
title: JVM.09 类加载及执行子系统的案例与实战
date: 2023-11-12 15:55:48
tags:
  - jvm
  - 类加载
---


## 概述

## 案例分析

### Tomcat：正统的类加载器架构

主流的Java Web服务器，如Tomcat、Jetty、WebLogic、WebSphere或其他服务器， 都实现了自己定义的类加载器，而且一般还都不止一个。因为一个功能健全的Web服务器，都要解决如下的这些问题：

- 部署在同一个服务器上的两个Web应用程序所使用的Java类库可以实现相互隔离。
- 部署在同一个服务器上的两个Web应用程序所使用的Java类库可以互相共享。
- 服务器需要尽可能地保证自身的安全不受部署的Web应用程序影响。
- 支持JSP应用的Web服务器，十有八九都需要支持`HotSwap`功能。

在Tomcat目录结构中，可以设置3组目录（/common/*、/server/*和/shared/*，但默认不一定是开放 的，可能只有/lib/*目录存在）用于存放Java类库，另外还应该加上Web应用程序自身的“/WEB-INF/*”目录，一共4组。把Java类库放置在这4组目录中，每一组都有独立的含义，分别是： 

- 放置在/common目录中。类库可被Tomcat和所有的Web应用程序共同使用。 
- 放置在/server目录中。类库可被Tomcat使用，对所有的Web应用程序都不可见。 
- 放置在/shared目录中。类库可被所有的Web应用程序共同使用，但对Tomcat自己不可见。 
- 放置在/WebApp/WEB-INF目录中。类库仅仅可以被该Web应用程序使用，对Tomcat和其他Web应用程序都不可见。 

为了支持这套目录结构，并对目录里面的类库进行加载和隔离，Tomcat自定义了多个类加载器， 这些类加载器按照经典的双亲委派模型来实现，其关系如图9-1所示。

![image-20220113205528816](https://cdn.astero.xyz/img/202201132055873.png)

这一结构在Tomcat6以后被简化了。。。

### OSGi：灵活的类加载器架构

> 学习Java EE规范，推荐去看`JBoss`源码；学习类加载器的知识，就推荐去看`OSGi`源码。

### 字节码生成技术与动态代理的实现

### Backport工具：Java的时光机器

## 实战：自己动手实现远程执行功能